<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API リファレンス (v1.4.2)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Source+Code+Pro:wght@400;600&display=swap"
        rel="stylesheet">

    <style>
        :root {
            --primary-color: #007bff;
            --primary-hover: #0056b3;
            --text-color: #333;
            --text-light: #555;
            --bg-color: #f9f9f9;
            --card-bg: #fff;
            --border-color: #e9ecef;
            --code-bg: #e9ecef;
            --section-gap: 40px;
            --transition-speed: 0.3s;
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 5px 20px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 8px 30px rgba(0, 0, 0, 0.15);
            --badge-post-bg: #28a745;
            --badge-post-text: #fff;
            --badge-get-bg: #007bff;
            --badge-get-text: #fff;
            --badge-optional-bg: #e9ecef;
            --badge-optional-text: #6c757d;
            --badge-required-bg: #f8d7da;
            --badge-required-text: #dc3545;
            --badge-rate-limit-bg: #ffc107;
            --badge-rate-limit-text: #fff;
            --error-light-bg: #f8d7da;
            --error-dark-text: #721c24;
        }

        /* Dark Mode Colors */
        [data-theme="dark"] {
            --primary-color: #3498db;
            --primary-hover: #2980b9;
            --text-color: #f0f0f0;
            --text-light: #b0b0b0;
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --border-color: #2e2e2e;
            --code-bg: #2a2a2a;
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.5);
            --shadow-md: 0 5px 20px rgba(0, 0, 0, 0.5);
            --shadow-lg: 0 8px 30px rgba(0, 0, 0, 0.5);
            --badge-post-bg: #198754;
            --badge-post-text: #fff;
            --badge-get-bg: #0d6efd;
            --badge-get-text: #fff;
            --badge-optional-bg: #343a40;
            --badge-optional-text: #adb5bd;
            --badge-required-bg: #402025;
            --badge-required-text: #f8d7da;
            --badge-rate-limit-bg: #d39e00;
            --badge-rate-limit-text: #fff;
            --error-light-bg: #332222;
            --error-dark-text: #f8d7da;
        }

        /* Base Styles */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            scroll-behavior: smooth;
            scroll-padding-top: 80px;
        }

        body {
            font-family: 'Roboto', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            transition: background-color var(--transition-speed) ease;
        }

        /* Theme Toggle */
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: var(--card-bg);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--shadow-md);
            z-index: 100;
            transition: box-shadow var(--transition-speed) ease, background-color var(--transition-speed) ease;
        }

        .theme-toggle:hover {
            box-shadow: var(--shadow-lg);
        }

        .theme-toggle .fa-sun {
            display: none;
        }

        .theme-toggle .fa-moon {
            display: block;
        }

        [data-theme="dark"] .theme-toggle .fa-sun {
            display: block;
        }

        [data-theme="dark"] .theme-toggle .fa-moon {
            display: none;
        }

        /* Container */
        .container {
            width: 85%;
            max-width: 1200px;
            margin: 20px auto;
            padding: 30px;
            background-color: var(--card-bg);
            box-shadow: var(--shadow-md);
            border-radius: 10px;
            animation: fadeIn 0.5s ease-out;
            transition: box-shadow var(--transition-speed) ease, background-color var(--transition-speed) ease;
        }

        .container:hover {
            box-shadow: var(--shadow-lg);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Typography */
        h1,
        h2,
        h3,
        h4 {
            color: var(--primary-color);
            margin-top: 25px;
            margin-bottom: 15px;
            transition: color var(--transition-speed) ease;
        }

        h1:hover,
        h2:hover,
        h3:hover,
        h4:hover {
            color: var(--primary-hover);
        }

        h1 {
            border-bottom: 3px solid var(--primary-color);
            padding-bottom: 10px;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        .version {
            font-size: 0.5em;
            background-color: var(--primary-color);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            vertical-align: middle;
            position: relative;
            top: -5px;
        }

        code {
            background-color: var(--code-bg);
            padding: 3px 8px;
            border-radius: 5px;
            font-size: 0.9em;
            font-family: 'Source Code Pro', Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
            transition: background-color var(--transition-speed) ease;
        }

        pre {
            background-color: var(--code-bg);
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 0.9em;
            line-height: 1.4;
            position: relative;
            transition: background-color var(--transition-speed) ease;
        }

        ul {
            list-style-type: square;
            padding-left: 25px;
            margin-bottom: 15px;
        }

        li {
            margin-bottom: 8px;
        }

        strong {
            color: var(--primary-color);
        }

        p {
            margin-bottom: 20px;
            color: var(--text-light);
        }

        a {
            color: var(--primary-color);
            text-decoration: none;
            transition: color var(--transition-speed) ease;
        }

        a:hover {
            color: var(--primary-hover);
            text-decoration: underline;
        }

        /* Header and Base Info */
        .main-header {
            margin-bottom: 30px;
        }

        .description {
            font-size: 1.1em;
            line-height: 1.6;
            max-width: 800px;
        }

        .base-info {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 40px;
        }

        .info-card {
            flex: 1;
            min-width: 300px;
            display: flex;
            background-color: var(--card-bg);
            border-radius: 8px;
            box-shadow: var(--shadow-sm);
            padding: 15px;
            transition: box-shadow var(--transition-speed) ease, transform var(--transition-speed) ease;
        }

        .info-card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-3px);
        }

        .icon-wrapper {
            background-color: var(--primary-color);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
        }

        .icon-wrapper i {
            color: white;
            font-size: 1.5em;
        }

        .info-card .content {
            flex: 1;
        }

        .info-card h3 {
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .info-card p {
            margin-bottom: 10px;
        }

        .info-card ul {
            margin-bottom: 0;
        }

        .info-card li {
            margin-bottom: 5px;
        }

        .info-card li i {
            color: var(--primary-color);
            margin-right: 5px;
        }

        /* Navigation */
        .api-nav {
            margin-bottom: 30px;
            background-color: var(--card-bg);
            border-radius: 8px;
            box-shadow: var(--shadow-sm);
            padding: 15px;
            position: sticky;
            top: 20px;
            z-index: 10;
            transition: box-shadow var(--transition-speed) ease, background-color var(--transition-speed) ease;
        }

        .api-nav:hover {
            box-shadow: var(--shadow-md);
        }

        .nav-title {
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .api-nav ul {
            display: flex;
            list-style: none;
            padding: 0;
            margin: 0;
            overflow-x: auto;
            gap: 20px;
        }

        .api-nav li {
            margin: 0;
            white-space: nowrap;
        }

        .nav-link {
            display: block;
            padding: 8px 15px;
            border-radius: 5px;
            transition: background-color var(--transition-speed) ease;
        }

        .nav-link:hover {
            background-color: var(--code-bg);
            text-decoration: none;
        }

        /* Endpoint Sections */
        .endpoint-section {
            margin-bottom: var(--section-gap);
            padding-bottom: var(--section-gap);
            border-bottom: 1px solid var(--border-color);
            animation: fadeIn 0.5s ease-out;
            animation-fill-mode: both;
        }

        .endpoint-section:last-child {
            border-bottom: none;
        }

        .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-number {
            background-color: var(--primary-color);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
            font-size: 1.2em;
        }

        .section-header h2 {
            margin: 0;
        }

        .endpoint-url {
            background-color: var(--code-bg);
            padding: 12px 15px;
            border-radius: 8px;
            margin: 20px 0;
            display: flex;
            align-items: center;
            font-family: 'Source Code Pro', monospace;
            font-weight: 600;
        }

        .method {
            padding: 5px 8px;
            border-radius: 5px;
            margin-right: 10px;
            font-size: 0.9em;
            font-weight: bold;
        }

        .method.post {
            background-color: var(--badge-post-bg);
            color: var(--badge-post-text);
        }

        .method.get {
            background-color: var(--badge-get-bg);
            color: var(--badge-get-text);
        }

        /* Tabs */
        .tabs {
            margin: 30px 0;
        }

        .tab-buttons {
            display: flex;
            overflow-x: auto;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .tab-button {
            padding: 10px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1em;
            color: var(--text-light);
            position: relative;
            transition: color var(--transition-speed) ease;
        }

        .tab-button:hover {
            color: var(--primary-color);
        }

        .tab-button.active {
            color: var(--primary-color);
            font-weight: 500;
        }

        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: var(--primary-color);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease-out;
        }

        .tab-content.active {
            display: block;
        }

        /* Badges */
        .badge {
            display: inline-block;
            padding: 0.25em 0.6em;
            font-size: 75%;
            font-weight: 700;
            line-height: 1;
            text-align: center;
            white-space: nowrap;
            vertical-align: baseline;
            border-radius: 0.375rem;
            margin-left: 5px;
        }

        .badge.optional {
            color: var(--badge-optional-text);
            background-color: var(--badge-optional-bg);
        }

        .badge.required {
            color: var(--badge-required-text);
            background-color: var(--badge-required-bg);
        }

        .badge.rate-limit {
            color: var(--badge-rate-limit-text);
            background-color: var(--badge-rate-limit-bg);
        }

        /* Parameter Details */
        .param-details {
            margin: 20px 0;
            background-color: var(--code-bg);
            border-radius: 8px;
            padding: 15px;
        }

        .param-details h4 {
            margin-top: 0;
        }

        /* Error Cards */
        .error-card {
            margin: 20px 0;
            border-radius: 8px;
            border-left: 5px solid var(--error-dark-text);
            background-color: var(--error-light-bg);
            overflow: hidden;
        }

        .error-status {
            padding: 10px 15px;
            background-color: rgba(0, 0, 0, 0.05);
            font-weight: 600;
        }

        .error-details {
            padding: 15px;
        }

        .error-details p {
            margin-bottom: 10px;
        }

        .error-details pre {
            margin-top: 10px;
        }

        /* Response Types */
        .response-type {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .response-type:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .sse-example {
            background-color: var(--code-bg);
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
        }

        .sse-example p {
            margin-bottom: 5px;
            font-weight: 500;
        }

        .sse-example p.note {
            font-style: italic;
            font-size: 0.9em;
            opacity: 0.7;
        }

        /* Example Sections */
        .example-item {
            margin-bottom: 25px;
            background-color: var(--code-bg);
            border-radius: 8px;
            overflow: hidden;
            position: relative;
        }

        .example-title {
            padding: 10px 15px;
            font-weight: 600;
            background-color: rgba(0, 0, 0, 0.05);
        }

        .example-title i {
            margin-right: 5px;
        }

        .example-note {
            font-size: 0.9em;
            font-style: italic;
            padding: 5px 15px 15px;
        }

        .copy-btn {
            position: absolute;
            top: 6px;
            right: 6px;
            background-color: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 4px;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color var(--transition-speed) ease;
            opacity: 0.7;
        }

        .copy-btn:hover {
            background-color: rgba(255, 255, 255, 0.4);
            opacity: 1;
        }

        /* Language Selector and Code Samples */
        .language-selector {
            display: flex;
            margin-bottom: 20px;
            background-color: var(--code-bg);
            border-radius: 8px;
            overflow: hidden;
        }

        .lang-btn {
            flex: 1;
            padding: 10px 15px;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            transition: background-color var(--transition-speed) ease;
        }

        .lang-btn:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        .lang-btn.active {
            background-color: var(--primary-color);
            color: white;
        }

        .code-category-tabs {
            display: none;
            margin-top: 30px;
        }

        .code-category-tabs.active {
            display: block;
            animation: fadeIn 0.3s ease-out;
        }

        .category-buttons {
            display: flex;
            overflow-x: auto;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .category-btn {
            padding: 10px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1em;
            color: var(--text-light);
            position: relative;
            white-space: nowrap;
            transition: color var(--transition-speed) ease;
        }

        .category-btn:hover {
            color: var(--primary-color);
        }

        .category-btn.active {
            color: var(--primary-color);
            font-weight: 500;
        }

        .category-btn.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: var(--primary-color);
        }

        .code-sample {
            display: none;
            position: relative;
        }

        .code-sample.active {
            display: block;
            animation: fadeIn 0.3s ease-out;
        }

        .code-sample h3 {
            margin-top: 0;
            margin-bottom: 15px;
        }

        /* Footer */
        .main-footer {
            text-align: center;
            margin-top: 50px;
            padding: 20px 0;
            color: var(--text-light);
            font-size: 0.9em;
        }

        /* Responsive Styles */
        @media (max-width: 992px) {
            .container {
                width: 90%;
                padding: 25px;
            }
        }

        @media (max-width: 768px) {
            .container {
                width: 95%;
                padding: 20px;
            }

            h1 {
                font-size: 2em;
            }

            h2 {
                font-size: 1.5em;
            }

            .section-number {
                width: 35px;
                height: 35px;
                font-size: 1.1em;
            }

            .base-info {
                flex-direction: column;
            }

            .info-card {
                min-width: 100%;
            }
        }

        @media (max-width: 576px) {
            .container {
                width: 100%;
                border-radius: 0;
                margin: 0;
            }

            .tab-button,
            .category-btn {
                padding: 10px 15px;
                font-size: 0.9em;
            }

            .example-title {
                padding: 8px 10px;
                font-size: 0.9em;
            }

            pre {
                padding: 10px;
                font-size: 0.8em;
            }

            .endpoint-url {
                flex-direction: column;
                align-items: flex-start;
            }

            .method {
                margin-bottom: 5px;
            }
        }
    </style>
</head>

<body>
    <div class="theme-toggle">
        <i class="fa-solid fa-moon"></i>
        <i class="fa-solid fa-sun"></i>
    </div>

    <div class="container">
        <header class="main-header">
            <h1>API リファレンス <span class="version">v1.4.2</span></h1>
            <p class="description">このドキュメントは、<code>g4f</code> ライブラリを利用して様々な AI プロバイダーとの対話や画像生成を行うためのバックエンド API サーバー
                (バージョン 1.4.2) の仕様を記述します。</p>
        </header>

        <section class="base-info">
            <div class="info-card">
                <div class="icon-wrapper">
                    <i class="fa-solid fa-server"></i>
                </div>
                <div class="content">
                    <h3>ベース URL</h3>
                    <p><code>http://&lt;サーバーアドレス&gt;:&lt;ポート&gt;</code> (デフォルト: <code>http://127.0.0.1:9002</code>)</p>
                </div>
            </div>

            <div class="info-card">
                <div class="icon-wrapper">
                    <i class="fa-solid fa-book"></i>
                </div>
                <div class="content">
                    <h3>自動生成ドキュメント</h3>
                    <p>より詳細な対話型ドキュメントが以下で利用可能です。</p>
                    <ul>
                        <li><i class="fa-solid fa-arrow-right"></i> Swagger UI: <a href="/docs"
                                target="_blank"><code>/docs</code></a></li>
                        <li><i class="fa-solid fa-arrow-right"></i> ReDoc: <a href="/redoc"
                                target="_blank"><code>/redoc</code></a></li>
                    </ul>
                </div>
            </div>
        </section>

        <nav class="api-nav">
            <div class="nav-title">API エンドポイント</div>
            <ul>
                <li><a href="#models" class="nav-link">利用可能な識別子リスト</a></li>
                <li><a href="#chat" class="nav-link">AI との対話 / 画像生成</a></li>
                <li><a href="#samples" class="nav-link">サンプルコード</a></li>
            </ul>
        </nav>

        <div class="endpoint-section" id="models">
            <div class="section-header">
                <span class="section-number">1</span>
                <h2>利用可能な識別子リストの取得</h2>
            </div>
            <p>利用可能な AI プロバイダーまたはモデルの識別子リストを取得します。</p>

            <div class="endpoint-url">
                <span class="method post">POST</span>
                <code>/models</code>
            </div>

            <div class="tabs">
                <div class="tab-buttons">
                    <button class="tab-button active" data-tab="request">リクエスト</button>
                    <button class="tab-button" data-tab="response">レスポンス</button>
                    <button class="tab-button" data-tab="errors">エラー</button>
                    <button class="tab-button" data-tab="examples">使用例</button>
                </div>

                <div class="tab-content active" data-tab="request">
                    <h3>リクエストボディ (JSON):</h3>
                    <pre><code>{
  "type": "string", <span class="badge optional">Optional (default: 'provider')</span>
  "filter": "string" <span class="badge optional">Optional</span>
}</code></pre>
                    <div class="param-details">
                        <h4>パラメータ詳細:</h4>
                        <ul>
                            <li><code>type</code>: 取得する識別子の種類を指定します。
                                <ul>
                                    <li><code>"provider"</code> (デフォルト): 利用可能なプロバイダー名のリストを返します。</li>
                                    <li><code>"model"</code>: 利用可能なモデル名のリストを返します。</li>
                                </ul>
                            </li>
                            <li><code>filter</code>: 指定した場合、識別子リストを部分一致 (大文字小文字を区別しない) でフィルタリングします。</li>
                        </ul>
                    </div>
                </div>

                <div class="tab-content" data-tab="response">
                    <h3>成功レスポンス (200 OK):</h3>
                    <ul>
                        <li>Content-Type: <code>application/json</code></li>
                        <li>ボディ: <code>type</code> で指定された種類の識別子 (プロバイダー名またはモデル名) の文字列リスト。<code>filter</code>
                            が指定されていればフィルタリング後のリスト。</li>
                    </ul>
                    <pre><code>// type="provider" の場合
["Grok", "Llama", "Mixtral", "Gemini", ...]

// type="model" の場合
["grok-3", "llama-3-70b", "gemini-1.5-flash", ...]</code></pre>
                </div>

                <div class="tab-content" data-tab="errors">
                    <h3>エラーレスポンス:</h3>
                    <div class="error-card">
                        <div class="error-status">400 Bad Request</div>
                        <div class="error-details">
                            <p>Content-Type: <code>application/json</code></p>
                            <p>ボディ: <code>type</code> パラメータに無効な値 (<code>"provider"</code> または <code>"model"</code> 以外)
                                が指定された場合。</p>
                            <pre><code>{
  "detail": "無効な type '&lt;指定されたtype&gt;' です。有効な type は 'provider' または 'model' です。"
}</code></pre>
                        </div>
                    </div>

                    <div class="error-card">
                        <div class="error-status">500 Internal Server Error</div>
                        <div class="error-details">
                            <p>Content-Type: <code>application/json</code></p>
                            <p>ボディ: サーバー内部でリストの取得に失敗した場合。</p>
                            <pre><code>{
  "detail": "g4fから&lt;type&gt;リストを取得できませんでした。"
}</code></pre>
                        </div>
                    </div>
                </div>

                <div class="tab-content" data-tab="examples">
                    <h3>cURL 例:</h3>
                    <div class="example-item">
                        <div class="example-title">プロバイダーリスト取得 (デフォルト)</div>
                        <pre><code>curl -X POST http://127.0.0.1:9002/models -H "Content-Type: application/json" -d '{}'</code></pre>
                    </div>

                    <div class="example-item">
                        <div class="example-title">モデルリスト取得</div>
                        <pre><code>curl -X POST http://127.0.0.1:9002/models -H "Content-Type: application/json" -d '{"type": "model"}'</code></pre>
                    </div>

                    <div class="example-item">
                        <div class="example-title">"gpt" を含むプロバイダーリスト取得</div>
                        <pre><code>curl -X POST http://127.0.0.1:9002/models -H "Content-Type: application/json" -d '{"type": "provider", "filter": "gpt"}'</code></pre>
                    </div>

                    <div class="example-item">
                        <div class="example-title">"llama" を含むモデルリスト取得</div>
                        <pre><code>curl -X POST http://127.0.0.1:9002/models -H "Content-Type: application/json" -d '{"type": "model", "filter": "llama"}'</code></pre>
                    </div>
                </div>
            </div>
        </div>

        <div class="endpoint-section" id="chat">
            <div class="section-header">
                <span class="section-number">2</span>
                <h2>AI との対話 / 画像生成</h2>
            </div>
            <p>指定したプロバイダーとモデルを使用して AI と対話、または画像を生成します。<code>type</code> パラメータで動作を切り替えます。</p>

            <div class="endpoint-url">
                <span class="method post">POST</span>
                <code>/chat</code>
            </div>

            <div class="tabs">
                <div class="tab-buttons">
                    <button class="tab-button active" data-tab="request">リクエスト</button>
                    <button class="tab-button" data-tab="response">レスポンス</button>
                    <button class="tab-button" data-tab="errors">エラー</button>
                    <button class="tab-button" data-tab="examples">使用例</button>
                </div>

                <div class="tab-content active" data-tab="request">
                    <h3>リクエストボディ (JSON):</h3>
                    <pre><code>{
  "provider_name": "string | null", <span class="badge optional">Optional</span>
  "model": "string", <span class="badge required">Required</span>
  "message": "string", <span class="badge required">Required (Prompt for chat/image)</span>
  "api_key": "string | null", <span class="badge optional">Optional</span>
  "auth_key": "string | null", <span class="badge optional">Optional (Currently unused)</span>
  "stream": "boolean", <span class="badge optional">Optional (default: false, for type='chat' only)</span>
  "type": "string" <span class="badge optional">Optional (default: 'chat')</span>
}</code></pre>
                    <div class="param-details">
                        <h4>パラメータ詳細:</h4>
                        <ul>
                            <li><code>provider_name</code>: 使用する AI プロバイダーの識別子 (例:
                                <code>"Gemini"</code>)。<code>/models</code> エンドポイント (<code>type="provider"</code>)
                                で取得した名前を指定します。<strong>省略 (<code>null</code> または未指定) した場合、<code>g4f</code>
                                    のデフォルトプロバイダーが使用されます。</strong>
                            </li>
                            <li><code>model</code>: 使用するモデル名 (例: <code>"gemini-1.5-flash"</code>,
                                <code>"gpt-4o-mini"</code>, <code>"flux"</code> など)。プロバイダーがサポートするモデル識別子を指定します。
                            </li>
                            <li><code>message</code>: AI に送信するユーザーメッセージ (チャットの場合) または画像生成のプロンプト (画像生成の場合)。</li>
                            <li><code>api_key</code>: 特定のプロバイダー/モデルで必要となる API キー。</li>
                            <li><code>auth_key</code>: 認証キー（現在のバージョンでは使用されていません）。</li>
                            <li><code>stream</code>: <code>type="chat"</code> の場合にのみ有効。<code>true</code>
                                に設定するとレスポンスがストリーミング (SSE) 形式になります。<code>false</code> または未指定の場合は、完了後に全レスポンスが JSON
                                で返されます。画像生成リクエストでは無視されます。</li>
                            <li><code>type</code>: リクエストの種類を指定します。
                                <ul>
                                    <li><code>"chat"</code> (デフォルト): AI と対話します。</li>
                                    <li><code>"image@url"</code>: 画像を生成し、その画像の URL を返します。 <span
                                            class="badge rate-limit">Rate Limit: 10 RPM</span></li>
                                    <li><code>"image@b64"</code>: 画像を生成し、Base64 エンコードされた画像データを返します。 <span
                                            class="badge rate-limit">Rate Limit: 10 RPM</span></li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                </div>

                <div class="tab-content" data-tab="response">
                    <h3>成功レスポンス (200 OK)</h3>

                    <div class="response-type">
                        <h4>type="chat", stream=false:</h4>
                        <ul>
                            <li>Content-Type: <code>application/json</code></li>
                            <li>ボディ: AI からの完全な応答を含む JSON オブジェクト。</li>
                        </ul>
                        <pre><code>{
  "response": "AI からの応答テキストです。"
}</code></pre>
                    </div>

                    <div class="response-type">
                        <h4>type="chat", stream=true:</h4>
                        <ul>
                            <li>Content-Type: <code>text/event-stream</code></li>
                            <li>ボディ: Server-Sent Events のストリーム。</li>
                        </ul>
                        <div class="sse-example">
                            <p>メッセージチャンク:</p>
                            <pre><code>data: {"delta": "応答の一部"}

data: {"delta": "次の応答部分"}

...</code></pre>
                            <p>ストリーム終了:</p>
                            <pre><code>data: {"end_of_stream": true}</code></pre>
                            <p>ストリーミング中のエラー:</p>
                            <pre><code>event: error
data: {"error": "エラーメッセージ", "status_code": 4xx or 5xx, "provider": "プロバイダー名またはDefault", "model": "モデル名"}</code></pre>
                            <p class="note">(注意: ストリーミング中のエラー発生時、HTTP ステータスコードは 200 のままです)</p>
                        </div>
                    </div>

                    <div class="response-type">
                        <h4>type="image@url":</h4>
                        <ul>
                            <li>Content-Type: <code>application/json</code></li>
                            <li>ボディ: 生成された画像の URL を含む JSON オブジェクト。</li>
                        </ul>
                        <pre><code>{
  "image_url": "https://..."
}</code></pre>
                    </div>

                    <div class="response-type">
                        <h4>type="image@b64":</h4>
                        <ul>
                            <li>Content-Type: <code>application/json</code></li>
                            <li>ボディ: 生成された画像の Base64 エンコードデータを含む JSON オブジェクト。</li>
                        </ul>
                        <pre><code>{
  "image_b64": "iVBORw0KGgoAAAANSUhEUgAAB..."
}</code></pre>
                    </div>
                </div>

                <div class="tab-content" data-tab="errors">
                    <h3>エラーレスポンス (非ストリーミング時 / ストリーミング開始前):</h3>

                    <div class="error-card">
                        <div class="error-status">400 Bad Request</div>
                        <div class="error-details">
                            <p>Content-Type: <code>application/json</code></p>
                            <p>原因:</p>
                            <ul>
                                <li>指定された <code>provider_name</code> が無効。</li>
                                <li>指定された <code>type</code> が無効 (<code>"chat"</code>, <code>"image@url"</code>,
                                    <code>"image@b64"</code> 以外)。
                                </li>
                            </ul>
                            <p>ボディ例 (Provider名無効):</p>
                            <pre><code>{
  "detail": "指定されたProvider名 '&lt;無効な名前&gt;' は無効です。利用可能なProvider: ['Grok', 'Llama', ...]"
}</code></pre>
                            <p>ボディ例 (Type無効):</p>
                            <pre><code>{
  "detail": "無効なリクエストタイプ '&lt;無効なタイプ&gt;' です。'chat'、'image@url'、または 'image@b64' を使用してください。"
}</code></pre>
                        </div>
                    </div>

                    <div class="error-card">
                        <div class="error-status">401 Unauthorized</div>
                        <div class="error-details">
                            <p>Content-Type: <code>application/json</code></p>
                            <p>原因: AI プロバイダーでの認証に失敗した場合 (例: 不正な <code>api_key</code>)。</p>
                            <pre><code>{
  "detail": "AIプロバイダーでの認証に失敗しました: &lt;元のエラー詳細&gt;"
}</code></pre>
                        </div>
                    </div>

                    <div class="error-card">
                        <div class="error-status">404 Not Found</div>
                        <div class="error-details">
                            <p>Content-Type: <code>application/json</code></p>
                            <p>原因:</p>
                            <ul>
                                <li>(チャット) 指定された <code>model</code> がプロバイダー内部で見つからないかサポートされていない
                                    (<code>ProviderNotFoundError</code> または <code>ModelNotFoundError</code>)。</li>
                                <li>(画像生成) 指定された <code>model</code> が画像生成モデルとして見つからないかサポートされていない
                                    (<code>ModelNotFoundError</code>)。</li>
                            </ul>
                            <p>ボディ例 (チャット):</p>
                            <pre><code>{
  "detail": "プロバイダー '&lt;Provider名&gt;' がモデル '&lt;Model名&gt;' をサポートしていないか、見つかりません: &lt;元のエラー詳細&gt;"
}</code></pre>
                            <p>ボディ例 (画像生成):</p>
                            <pre><code>{
  "detail": "画像生成モデル '&lt;Model名&gt;' が見つからないか、サポートされていません: &lt;元のエラー詳細&gt;"
}</code></pre>
                        </div>
                    </div>

                    <div class="error-card">
                        <div class="error-status">429 Too Many Requests <span class="badge rate-limit">画像生成のみ</span>
                        </div>
                        <div class="error-details">
                            <p>Content-Type: <code>application/json</code></p>
                            <p>原因: 画像生成リクエストのレートリミット (デフォルト: 10回/60秒) を超過した場合。</p>
                            <p>ヘッダー: <code>Retry-After</code> に再試行可能までの秒数が含まれる場合があります。</p>
                            <pre><code>{
  "detail": "画像生成リクエストが多すぎます。60秒あたり10回のリクエストに制限されています。しばらくしてから再試行してください。"
}</code></pre>
                        </div>
                    </div>

                    <!-- 他のエラーも同様に表示 -->
                    <div class="error-card">
                        <div class="error-status">500 Internal Server Error</div>
                        <div class="error-details">
                            <p>Content-Type: <code>application/json</code></p>
                            <p>原因:</p>
                            <ul>
                                <li>(画像生成) G4F 内部の画像生成コンポーネント (例: Flask アプリケーション) が見つからないなど、予期せぬ内部エラー。</li>
                                <li>サーバー側の予期せぬエラー全般。</li>
                            </ul>
                            <p>ボディ例 (画像生成コンポーネントエラー):</p>
                            <pre><code>{
  "detail": "画像プロバイダーの内部コンポーネント(Flask)が見つかりませんでした。G4Fの依存関係を確認してください。"
}</code></pre>
                            <p>ボディ例 (その他):</p>
                            <pre><code>{
  "detail": "Internal Server Error"
}</code></pre>
                        </div>
                    </div>

                    <div class="error-card">
                        <div class="error-status">502 Bad Gateway</div>
                        <div class="error-details">
                            <p>Content-Type: <code>application/json</code></p>
                            <p>原因:</p>
                            <ul>
                                <li>(チャット) AI プロバイダーから有効な応答コンテンツが得られなかった場合 (例: レスポンス形式が予期しないものだった)。</li>
                                <li>(画像生成) G4F がプロバイダーから有効な画像データを取得できなかった場合。</li>
                            </ul>
                            <p>ボディ例 (チャット):</p>
                            <pre><code>{
  "detail": "AIプロバイダーから有効な応答コンテンツを取得できませんでした。"
}</code></pre>
                            <p>ボディ例 (画像生成):</p>
                            <pre><code>{
  "detail": "G4Fから有効な画像データを取得できませんでした。"
}</code></pre>
                        </div>
                    </div>

                    <div class="error-card">
                        <div class="error-status">503 Service Unavailable</div>
                        <div class="error-details">
                            <p>Content-Type: <code>application/json</code></p>
                            <p>原因: AI プロバイダーサービス自体への接続に失敗した場合、または通信中に予期せぬエラーが発生した場合 (タイムアウト以外)。</p>
                            <pre><code>{
  "detail": "AIプロバイダーサービスでエラーが発生しました: &lt;元のエラー詳細&gt;"
}</code></pre>
                        </div>
                    </div>

                    <div class="error-card">
                        <div class="error-status">504 Gateway Timeout</div>
                        <div class="error-details">
                            <p>Content-Type: <code>application/json</code></p>
                            <p>原因: AI プロバイダーへの接続がタイムアウトした場合。</p>
                            <pre><code>{
  "detail": "AIプロバイダーへの接続に失敗しました: &lt;元のエラー詳細&gt;"
}</code></pre>
                        </div>
                    </div>
                </div>

                <div class="tab-content" data-tab="examples">
                    <h3>cURL 例:</h3>

                    <div class="example-item">
                        <div class="example-title"><i class="fa-solid fa-comment"></i> チャット - 非ストリーミング (プロバイダー指定)</div>
                        <pre><code>curl -X POST http://127.0.0.1:9002/chat \
  -H "Content-Type: application/json" \
  -d '{
        "provider_name": "Gemini",
        "model": "gemini-1.5-flash",
        "message": "日本の首都はどこですか？",
        "stream": false,
        "type": "chat"
      }'</code></pre>
                        <button class="copy-btn" data-clipboard-target="this"><i
                                class="fa-regular fa-copy"></i></button>
                    </div>

                    <div class="example-item">
                        <div class="example-title"><i class="fa-solid fa-comment"></i> チャット - 非ストリーミング (プロバイダー指定なし -
                            デフォルト使用)</div>
                        <pre><code>curl -X POST http://127.0.0.1:9002/chat \
  -H "Content-Type: application/json" \
  -d '{
        "model": "gpt-4o-mini",
        "message": "デフォルトプロバイダーで応答してください。",
        "stream": false
      }'</code></pre>
                        <button class="copy-btn" data-clipboard-target="this"><i
                                class="fa-regular fa-copy"></i></button>
                    </div>

                    <div class="example-item">
                        <div class="example-title"><i class="fa-solid fa-stream"></i> チャット - ストリーミング (プロバイダー指定)</div>
                        <pre><code>curl -X POST http://127.0.0.1:9002/chat \
  -H "Content-Type: application/json" \
  -H "Accept: text/event-stream" \
  -d '{
        "provider_name": "Gemini",
        "model": "gemini-1.5-flash",
        "message": "自己紹介をしてください。",
        "stream": true
      }' --no-buffer</code></pre>
                        <button class="copy-btn" data-clipboard-target="this"><i
                                class="fa-regular fa-copy"></i></button>
                        <p class="example-note">(<code>--no-buffer</code> オプションは、curl
                            がレスポンスをバッファリングせず、受信次第表示するために推奨されます)</p>
                    </div>

                    <div class="example-item">
                        <div class="example-title"><i class="fa-solid fa-image"></i> 画像生成 - URL取得</div>
                        <pre><code>curl -X POST http://127.0.0.1:9002/chat \
  -H "Content-Type: application/json" \
  -d '{
        "model": "flux",
        "message": "宇宙を飛ぶ猫",
        "type": "image@url"
      }'</code></pre>
                        <button class="copy-btn" data-clipboard-target="this"><i
                                class="fa-regular fa-copy"></i></button>
                    </div>

                    <div class="example-item">
                        <div class="example-title"><i class="fa-solid fa-file-image"></i> 画像生成 - Base64取得</div>
                        <pre><code>curl -X POST http://127.0.0.1:9002/chat \
  -H "Content-Type: application/json" \
  -d '{
        "model": "flux",
        "message": "サイバーパンクな街並み",
        "type": "image@b64"
      }'</code></pre>
                        <button class="copy-btn" data-clipboard-target="this"><i
                                class="fa-regular fa-copy"></i></button>
                    </div>
                </div>
            </div>
        </div>

        <div class="endpoint-section" id="samples">
            <div class="section-header">
                <span class="section-number">3</span>
                <h2>サンプルコード</h2>
            </div>
            <p>以下は、各言語でのAPIの利用例です。</p>

            <div class="language-selector">
                <button class="lang-btn active" data-lang="js">JavaScript</button>
                <button class="lang-btn" data-lang="py">Python</button>
            </div>

            <div class="code-category-tabs js-samples active">
                <div class="category-buttons">
                    <button class="category-btn active" data-category="chat">チャット</button>
                    <button class="category-btn" data-category="stream">ストリーミング</button>
                    <button class="category-btn" data-category="image-url">画像 URL</button>
                    <button class="category-btn" data-category="image-b64">画像 Base64</button>
                </div>

                <div class="code-samples">
                    <div class="code-sample active" data-category="chat">
                        <h3>JavaScript: チャット (非ストリーミング)</h3>
                        <pre><code class="language-javascript">async function chatWithAI(providerName, model, message, apiKey = null) {
                                  const apiUrl = "http://127.0.0.1:9002/chat";
                                  const payload = {
                                    provider_name: providerName, // null or provider name string
                                    model: model,
                                    message: message,
                                    api_key: apiKey,
                                    stream: false,
                                    type: "chat" // Explicitly set type for clarity
                                  };
                                
                                  try {
                                    const response = await fetch(apiUrl, {
                                      method: "POST",
                                      headers: {
                                        "Content-Type": "application/json",
                                      },
                                      body: JSON.stringify(payload),
                                    });
                                
                                    if (!response.ok) {
                                      let errorDetail = `HTTP error! status: ${response.status}`;
                                      try {
                                        const errorData = await response.json();
                                        errorDetail = errorData.detail || JSON.stringify(errorData);
                                      } catch (e) {
                                        errorDetail = await response.text();
                                      }
                                      throw new Error(errorDetail);
                                    }
                                
                                    const data = await response.json();
                                    return data.response;
                                
                                  } catch (error) {
                                    console.error("Error during chat request:", error);
                                    throw error;
                                  }
                                }
                                
                                // 使用例 1: プロバイダー指定
                                chatWithAI("Gemini", "gemini-1.5-flash", "こんにちは")
                                  .then(response => console.log("AI Response (Gemini):", response))
                                  .catch(error => console.error("Error (Gemini):", error.message));
                                
                                // 使用例 2: プロバイダー指定なし (デフォルトを使用)
                                chatWithAI(null, "gpt-4o-mini", "デフォルトプロバイダーで挨拶して")
                                  .then(response => console.log("AI Response (Default):", response))
                                  .catch(error => console.error("Error (Default):", error.message));</code></pre>
                        <button class="copy-btn" data-clipboard-target="this"><i
                                class="fa-regular fa-copy"></i></button>
                    </div>

                    <div class="code-sample" data-category="stream">
                        <h3>JavaScript: チャット (ストリーミング)</h3>
                        <pre><code class="language-javascript">async function chatWithAIStream(providerName, model, message, apiKey = null, onDelta, onEnd, onError) {
                                  const apiUrl = "http://127.0.0.1:9002/chat";
                                  const payload = {
                                    provider_name: providerName,
                                    model: model,
                                    message: message,
                                    api_key: apiKey,
                                    stream: true,
                                    type: "chat"
                                  };
                                
                                  try {
                                    const response = await fetch(apiUrl, {
                                      method: "POST",
                                      headers: {
                                        "Content-Type": "application/json",
                                        "Accept": "text/event-stream"
                                      },
                                      body: JSON.stringify(payload),
                                    });
                                
                                    if (!response.ok) {
                                      let errorDetail = `HTTP error! status: ${response.status}`;
                                       try {
                                        const errorData = await response.json();
                                        errorDetail = errorData.detail || JSON.stringify(errorData);
                                      } catch (e) {
                                        errorDetail = await response.text();
                                      }
                                      throw new Error(errorDetail);
                                    }
                                
                                    const reader = response.body.getReader();
                                    const decoder = new TextDecoder();
                                    let buffer = '';
                                
                                    while (true) {
                                      const { done, value } = await reader.read();
                                      if (done) {
                                        console.log("Stream finished.");
                                        // Check buffer for any remaining data if necessary
                                        break;
                                      }
                                
                                      buffer += decoder.decode(value, { stream: true });
                                      const lines = buffer.split('\n\n');
                                      buffer = lines.pop(); // Keep incomplete message
                                
                                      for (const line of lines) {
                                        if (line.startsWith('data: ')) {
                                          const dataStr = line.substring(6);
                                          try {
                                            const data = JSON.parse(dataStr);
                                            if (data.delta) {
                                              if (onDelta) onDelta(data.delta);
                                            } else if (data.end_of_stream) {
                                              if (onEnd) onEnd();
                                              return; // End gracefully
                                            }
                                          } catch (e) {
                                            console.error("Failed to parse SSE data:", dataStr, e);
                                          }
                                        } else if (line.startsWith('event: error')) {
                                           // Find the next data line for the error payload
                                           const dataLineIndex = lines.indexOf(line) + 1;
                                           if (dataLineIndex < lines.length && lines[dataLineIndex].startsWith('data: ')) {
                                               const errorDataStr = lines[dataLineIndex].substring(6);
                                               try {
                                                   const errorData = JSON.parse(errorDataStr);
                                                   if (onError) onError(errorData);
                                               } catch (e) {
                                                   console.error("Failed to parse SSE error data:", errorDataStr, e);
                                                   if (onError) onError({ error: "Failed to parse error data", raw: errorDataStr });
                                               }
                                           } else {
                                               if (onError) onError({ error: "Received error event without data" });
                                           }
                                           return; // Stop on error event
                                        }
                                      }
                                    }
                                  } catch (error) {
                                    console.error("Error during streaming chat request:", error);
                                    if (onError) onError({ error: error.message });
                                  }
                                }
                                
                                // 使用例:
                                let fullResponse = "";
                                chatWithAIStream(
                                  "Gemini",
                                  "gemini-1.5-flash",
                                  "自己紹介をしてください。",
                                  null, // apiKey
                                  (delta) => {
                                    console.log("Delta:", delta);
                                    fullResponse += delta;
                                  },
                                  () => {
                                    console.log("Stream ended. Full response:", fullResponse);
                                  },
                                  (errorData) => {
                                    console.error("Stream Error:", errorData);
                                  }
                                );</code></pre>
                        <button class="copy-btn" data-clipboard-target="this"><i
                                class="fa-regular fa-copy"></i></button>
                    </div>

                    <div class="code-sample" data-category="image-url">
                        <h3>JavaScript: 画像生成 (URL取得)</h3>
                        <pre><code class="language-javascript">async function generateImageURL(model, prompt, apiKey = null) {
                                  const apiUrl = "http://127.0.0.1:9002/chat";
                                  const payload = {
                                    provider_name: null, // Provider often inferred from model for images
                                    model: model,
                                    message: prompt, // Use message as prompt
                                    api_key: apiKey,
                                    stream: false, // Ignored for image generation
                                    type: "image@url"
                                  };
                                
                                  try {
                                    const response = await fetch(apiUrl, {
                                      method: "POST",
                                      headers: {
                                        "Content-Type": "application/json",
                                      },
                                      body: JSON.stringify(payload),
                                    });
                                
                                    if (!response.ok) {
                                      let errorDetail = `HTTP error! status: ${response.status}`;
                                      try {
                                        const errorData = await response.json();
                                        errorDetail = errorData.detail || JSON.stringify(errorData);
                                      } catch (e) {
                                        errorDetail = await response.text();
                                      }
                                      // Include Retry-After header info if it's a 429 error
                                      if (response.status === 429) {
                                          const retryAfter = response.headers.get('Retry-After');
                                          if (retryAfter) {
                                              errorDetail += ` (Retry after ${retryAfter} seconds)`;
                                          }
                                      }
                                      throw new Error(errorDetail);
                                    }
                                
                                    const data = await response.json();
                                    return data.image_url;
                                
                                  } catch (error) {
                                    console.error("Error during image URL request:", error);
                                    throw error;
                                  }
                                }
                                
                                // 使用例:
                                generateImageURL("flux", "A cat wearing sunglasses riding a skateboard")
                                  .then(imageUrl => console.log("Generated Image URL:", imageUrl))
                                  .catch(error => console.error("Image Generation Error:", error.message));</code></pre>
                        <button class="copy-btn" data-clipboard-target="this"><i
                                class="fa-regular fa-copy"></i></button>
                    </div>

                    <div class="code-sample" data-category="image-b64">
                        <h3>JavaScript: 画像生成 (Base64取得)</h3>
                        <pre><code class="language-javascript">async function generateImageBase64(model, prompt, apiKey = null) {
                                  const apiUrl = "http://127.0.0.1:9002/chat";
                                  const payload = {
                                    provider_name: null,
                                    model: model,
                                    message: prompt,
                                    api_key: apiKey,
                                    stream: false,
                                    type: "image@b64"
                                  };
                                
                                  try {
                                    const response = await fetch(apiUrl, {
                                      method: "POST",
                                      headers: {
                                        "Content-Type": "application/json",
                                      },
                                      body: JSON.stringify(payload),
                                    });
                                
                                     if (!response.ok) {
                                      let errorDetail = `HTTP error! status: ${response.status}`;
                                      try {
                                        const errorData = await response.json();
                                        errorDetail = errorData.detail || JSON.stringify(errorData);
                                      } catch (e) {
                                        errorDetail = await response.text();
                                      }
                                       if (response.status === 429) {
                                          const retryAfter = response.headers.get('Retry-After');
                                          if (retryAfter) {
                                              errorDetail += ` (Retry after ${retryAfter} seconds)`;
                                          }
                                      }
                                      throw new Error(errorDetail);
                                    }
                                
                                    const data = await response.json();
                                    return data.image_b64; // Returns the Base64 string
                                
                                  } catch (error) {
                                    console.error("Error during image Base64 request:", error);
                                    throw error;
                                  }
                                }
                                
                                // 使用例:
                                generateImageBase64("flux", "A photorealistic image of a red apple on a wooden table")
                                  .then(b64Data => {
                                      console.log("Generated Image Base64 (first 100 chars):", b64Data.substring(0, 100) + "...");
                                      // You can use this data directly in an img tag:
                                      // const imgElement = document.createElement('img');
                                      // imgElement.src = `data:image/png;base64,${b64Data}`; // Assuming PNG format
                                      // document.body.appendChild(imgElement);
                                  })
                                  .catch(error => console.error("Image Generation Error:", error.message));</code></pre>
                        <button class="copy-btn" data-clipboard-target="this"><i
                                class="fa-regular fa-copy"></i></button>
                    </div>
                </div>
            </div>

            <div class="code-category-tabs py-samples">
                <div class="category-buttons">
                    <button class="category-btn active" data-category="chat">チャット</button>
                    <button class="category-btn" data-category="stream">ストリーミング</button>
                    <button class="category-btn" data-category="image-url">画像 URL</button>
                    <button class="category-btn" data-category="image-b64">画像 Base64</button>
                </div>

                <div class="code-samples">
                    <div class="code-sample active" data-category="chat">
                        <h3>Python: チャット (非ストリーミング)</h3>
                        <pre><code class="language-python">import requests
                                import json
                                from typing import Optional
                                
                                def chat_with_ai(provider_name: Optional[str], model: str, message: str, api_key: Optional[str] = None):
                                    url = "http://127.0.0.1:9002/chat"
                                    headers = {'Content-Type': 'application/json'}
                                    data = {
                                        "provider_name": provider_name,
                                        "model": model,
                                        "message": message,
                                        "api_key": api_key,
                                        "stream": False,
                                        "type": "chat"
                                    }
                                    try:
                                        response = requests.post(url, headers=headers, json=data)
                                        response.raise_for_status()
                                        return response.json()['response']
                                    except requests.exceptions.RequestException as e:
                                        print(f"Request failed: {e}")
                                        if e.response is not None:
                                            try:
                                                print(f"Error response: {e.response.json()}")
                                            except json.JSONDecodeError:
                                                print(f"Error response (text): {e.response.text}")
                                        return None
                                    except KeyError:
                                        print(f"Error: 'response' key not found in the JSON response.")
                                        try:
                                            print(f"Received JSON: {response.json()}")
                                        except json.JSONDecodeError:
                                             print(f"Received non-JSON response: {response.text}")
                                        return None
                                    except Exception as e:
                                        print(f"An unexpected error occurred: {e}")
                                        return None
                                
                                # 使用例 1: プロバイダー指定
                                try:
                                    response = chat_with_ai("Gemini", "gemini-1.5-flash", "こんにちは")
                                    if response:
                                        print("AI Response (Gemini):", response)
                                except Exception as e:
                                    print(f"An error occurred (Gemini): {e}")
                                
                                # 使用例 2: プロバイダー指定なし (デフォルトを使用)
                                try:
                                    response = chat_with_ai(None, "gpt-4o-mini", "デフォルトプロバイダーで挨拶して")
                                    if response:
                                        print("AI Response (Default):", response)
                                except Exception as e:
                                    print(f"An error occurred (Default): {e}")</code></pre>
                        <button class="copy-btn" data-clipboard-target="this"><i
                                class="fa-regular fa-copy"></i></button>
                    </div>

                    <div class="code-sample" data-category="stream">
                        <h3>Python: チャット (ストリーミング)</h3>
                        <pre><code class="language-python">import requests
                                import json
                                import sseclient # Requires: pip install sseclient-py
                                from typing import Optional
                                
                                def chat_with_ai_stream(provider_name: Optional[str], model: str, message: str, api_key: Optional[str] = None):
                                    url = "http://127.0.0.1:9002/chat"
                                    headers = {'Content-Type': 'application/json', 'Accept': 'text/event-stream'}
                                    data = {
                                        "provider_name": provider_name,
                                        "model": model,
                                        "message": message,
                                        "api_key": api_key,
                                        "stream": True,
                                        "type": "chat"
                                    }
                                    try:
                                        response = requests.post(url, headers=headers, json=data, stream=True)
                                        response.raise_for_status() # Check before processing stream
                                
                                        client = sseclient.SSEClient(response)
                                        full_response_text = ""
                                
                                        for event in client.events():
                                            if event.event == 'error':
                                                try:
                                                    error_data = json.loads(event.data)
                                                    print(f"\n--- Stream Error Received ---")
                                                    print(f"Status Code: {error_data.get('status_code', 'N/A')}")
                                                    print(f"Error: {error_data.get('error', 'Unknown error')}")
                                                    print(f"Provider: {error_data.get('provider', 'N/A')}")
                                                    print(f"Model: {error_data.get('model', 'N/A')}")
                                                    print(f"-----------------------------")
                                                    return None # Stop processing on error
                                                except json.JSONDecodeError:
                                                    print(f"\n--- Stream Error Received (Undecodable) ---")
                                                    print(f"Raw data: {event.data}")
                                                    print(f"------------------------------------------")
                                                    return None
                                
                                            if event.data:
                                                try:
                                                    data_dict = json.loads(event.data)
                                                    if 'delta' in data_dict:
                                                        delta = data_dict['delta']
                                                        print(delta, end='', flush=True)
                                                        full_response_text += delta
                                                    elif 'end_of_stream' in data_dict and data_dict['end_of_stream']:
                                                        print("\n--- End of Stream ---")
                                                        break
                                                except json.JSONDecodeError:
                                                    # Ignore if data is not valid JSON (might happen)
                                                    # print(f"\nWarning: Received non-JSON data: {event.data}")
                                                    pass
                                                except Exception as e:
                                                    print(f"\nError processing stream data: {e}")
                                                    print(f"Data received: {event.data}")
                                
                                        return full_response_text
                                
                                    except requests.exceptions.RequestException as e:
                                        print(f"\nRequest failed: {e}")
                                        if e.response is not None:
                                             try:
                                                print(f"Error response: {e.response.json()}")
                                             except json.JSONDecodeError:
                                                print(f"Error response (text): {e.response.text}")
                                        return None
                                    except Exception as e:
                                        print(f"\nAn unexpected error occurred during streaming: {e}")
                                        return None
                                
                                # 使用例 1: プロバイダー指定
                                print("\n--- Streaming Chat (Gemini) ---")
                                try:
                                    full_response = chat_with_ai_stream("Gemini", "gemini-1.5-flash", "Pythonで簡単なWebサーバーを立てるコードを教えてください。")
                                    # if full_response is not None:
                                    #     print("\nFinal assembled response (Gemini):\n", full_response)
                                except Exception as e:
                                    print(f"\nAn error occurred (Gemini Stream): {e}")
                                
                                # 使用例 2: プロバイダー指定なし (デフォルトを使用)
                                print("\n--- Streaming Chat (Default) ---")
                                try:
                                    full_response = chat_with_ai_stream(None, "gpt-4o-mini", "簡単な挨拶をストリーミングで返してください。")
                                    # if full_response is not None:
                                    #     print("\nFinal assembled response (Default):\n", full_response)
                                except Exception as e:
                                    print(f"\nAn error occurred (Default Stream): {e}")</code></pre>
                        <button class="copy-btn" data-clipboard-target="this"><i
                                class="fa-regular fa-copy"></i></button>
                    </div>

                    <div class="code-sample" data-category="image-url">
                        <h3>Python: 画像生成 (URL取得)</h3>
                        <pre><code class="language-python">import requests
                                import json
                                from typing import Optional
                                
                                def generate_image_url(model: str, prompt: str, api_key: Optional[str] = None):
                                    url = "http://127.0.0.1:9002/chat"
                                    headers = {'Content-Type': 'application/json'}
                                    data = {
                                        "model": model,
                                        "message": prompt, # Use message as prompt
                                        "api_key": api_key,
                                        "type": "image@url"
                                    }
                                    try:
                                        response = requests.post(url, headers=headers, json=data)
                                        response.raise_for_status()
                                        return response.json()['image_url']
                                    except requests.exceptions.RequestException as e:
                                        print(f"Request failed: {e}")
                                        if e.response is not None:
                                            try:
                                                error_details = e.response.json()
                                                print(f"Error response: {error_details}")
                                                # Check for Retry-After header in case of 429
                                                if e.response.status_code == 429:
                                                    retry_after = e.response.headers.get('Retry-After')
                                                    if retry_after:
                                                        print(f"Rate limit hit. Retry after {retry_after} seconds.")
                                            except json.JSONDecodeError:
                                                print(f"Error response (text): {e.response.text}")
                                        return None
                                    except KeyError:
                                        print(f"Error: 'image_url' key not found in the JSON response.")
                                        try:
                                            print(f"Received JSON: {response.json()}")
                                        except json.JSONDecodeError:
                                             print(f"Received non-JSON response: {response.text}")
                                        return None
                                    except Exception as e:
                                        print(f"An unexpected error occurred: {e}")
                                        return None
                                
                                # 使用例:
                                try:
                                    image_url = generate_image_url("flux", "A watercolor painting of a sunset over the ocean")
                                    if image_url:
                                        print("Generated Image URL:", image_url)
                                except Exception as e:
                                    print(f"An error occurred during image generation: {e}")</code></pre>
                        <button class="copy-btn" data-clipboard-target="this"><i
                                class="fa-regular fa-copy"></i></button>
                    </div>

                    <div class="code-sample" data-category="image-b64">
                        <h3>Python: 画像生成 (Base64取得)</h3>
                        <pre><code class="language-python">import requests
                                import json
                                from typing import Optional
                                import base64 # For potentially saving the image
                                
                                def generate_image_base64(model: str, prompt: str, api_key: Optional[str] = None):
                                    url = "http://127.0.0.1:9002/chat"
                                    headers = {'Content-Type': 'application/json'}
                                    data = {
                                        "model": model,
                                        "message": prompt,
                                        "api_key": api_key,
                                        "type": "image@b64"
                                    }
                                    try:
                                        response = requests.post(url, headers=headers, json=data)
                                        response.raise_for_status()
                                        return response.json()['image_b64'] # Returns the Base64 string
                                    except requests.exceptions.RequestException as e:
                                        print(f"Request failed: {e}")
                                        if e.response is not None:
                                            try:
                                                error_details = e.response.json()
                                                print(f"Error response: {error_details}")
                                                if e.response.status_code == 429:
                                                    retry_after = e.response.headers.get('Retry-After')
                                                    if retry_after:
                                                        print(f"Rate limit hit. Retry after {retry_after} seconds.")
                                            except json.JSONDecodeError:
                                                print(f"Error response (text): {e.response.text}")
                                        return None
                                    except KeyError:
                                        print(f"Error: 'image_b64' key not found in the JSON response.")
                                        try:
                                            print(f"Received JSON: {response.json()}")
                                        except json.JSONDecodeError:
                                             print(f"Received non-JSON response: {response.text}")
                                        return None
                                    except Exception as e:
                                        print(f"An unexpected error occurred: {e}")
                                        return None
                                
                                # 使用例:
                                try:
                                    b64_data = generate_image_base64("flux", "A cute robot waving hello")
                                    if b64_data:
                                        print("Generated Image Base64 (first 100 chars):", b64_data[:100] + "...")
                                        # Optional: Save the image to a file
                                        # try:
                                        #     image_data = base64.b64decode(b64_data)
                                        #     with open("generated_image.png", "wb") as f: # Assuming PNG format
                                        #         f.write(image_data)
                                        #     print("Image saved as generated_image.png")
                                        # except Exception as save_e:
                                        #     print(f"Error saving image: {save_e}")
                                except Exception as e:
                                    print(f"An error occurred during image generation: {e}")</code></pre>
                        <button class="copy-btn" data-clipboard-target="this"><i
                                class="fa-regular fa-copy"></i></button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="main-footer">
        <p>© 2023-2024 API Documentation</p>
        <p>バージョン 1.4.2</p>
    </footer>

    <script>document.addEventListener('DOMContentLoaded', function () {
            // Theme Toggle
            const themeToggle = document.querySelector('.theme-toggle');
            const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');

            // Check local storage or system preference for theme
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark' || (!savedTheme && prefersDarkScheme.matches)) {
                document.documentElement.setAttribute('data-theme', 'dark');
            }

            themeToggle.addEventListener('click', function () {
                const currentTheme = document.documentElement.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

                document.documentElement.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
            });

            // Tab Navigation
            const tabButtons = document.querySelectorAll('.tab-button');

            tabButtons.forEach(button => {
                button.addEventListener('click', function () {
                    const tabGroup = this.closest('.tabs');
                    const tabName = this.getAttribute('data-tab');

                    // Update active button
                    tabGroup.querySelectorAll('.tab-button').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    this.classList.add('active');

                    // Show active content
                    tabGroup.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    tabGroup.querySelector(`.tab-content[data-tab="${tabName}"]`).classList.add('active');
                });
            });

            // Language Selector
            const langButtons = document.querySelectorAll('.lang-btn');

            langButtons.forEach(button => {
                button.addEventListener('click', function () {
                    const lang = this.getAttribute('data-lang');

                    // Update active button
                    document.querySelectorAll('.lang-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    this.classList.add('active');

                    // Show active language samples
                    document.querySelectorAll('.code-category-tabs').forEach(tab => {
                        tab.classList.remove('active');
                    });
                    document.querySelector(`.${lang}-samples`).classList.add('active');
                });
            });

            // Code Category Navigation
            const categoryButtons = document.querySelectorAll('.category-btn');

            categoryButtons.forEach(button => {
                button.addEventListener('click', function () {
                    const categoryGroup = this.closest('.code-category-tabs');
                    const category = this.getAttribute('data-category');

                    // Update active button
                    categoryGroup.querySelectorAll('.category-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    this.classList.add('active');

                    // Show active content
                    categoryGroup.querySelectorAll('.code-sample').forEach(sample => {
                        sample.classList.remove('active');
                    });
                    categoryGroup.querySelector(`.code-sample[data-category="${category}"]`).classList.add('active');
                });
            });

            // Copy Code Buttons
            const copyButtons = document.querySelectorAll('.copy-btn');

            copyButtons.forEach(button => {
                button.addEventListener('click', function () {
                    const preElement = this.parentElement.querySelector('pre code');

                    if (preElement) {
                        const textToCopy = preElement.innerText;

                        navigator.clipboard.writeText(textToCopy).then(() => {
                            // Change button icon to check mark temporarily
                            const originalHTML = this.innerHTML;
                            this.innerHTML = '<i class="fa-solid fa-check"></i>';

                            setTimeout(() => {
                                this.innerHTML = originalHTML;
                            }, 2000);
                        }).catch(err => {
                            console.error('Could not copy text: ', err);
                        });
                    }
                });
            });

            // Smooth Scroll for Navigation Links
            const navLinks = document.querySelectorAll('.nav-link');

            navLinks.forEach(link => {
                link.addEventListener('click', function (e) {
                    e.preventDefault();

                    const targetId = this.getAttribute('href');
                    const targetElement = document.querySelector(targetId);

                    if (targetElement) {
                        window.scrollTo({
                            top: targetElement.offsetTop - 60,
                            behavior: 'smooth'
                        });
                    }
                });
            });

            // Add animation delay to endpoint sections for staggered entrance
            const endpointSections = document.querySelectorAll('.endpoint-section');
            endpointSections.forEach((section, index) => {
                section.style.animationDelay = `${index * 0.1}s`;
            });

            // Add syntax highlighting if prism.js is available
            if (typeof Prism !== 'undefined') {
                Prism.highlightAll();
            }

            // Handle dark mode adjustments for specific elements
            function adjustDarkModeElements() {
                const isDarkMode = document.documentElement.getAttribute('data-theme') === 'dark';

                // Adjust copy button styles for dark mode
                document.querySelectorAll('.copy-btn').forEach(btn => {
                    if (isDarkMode) {
                        btn.style.backgroundColor = 'rgba(255, 255, 255, 0.1)';
                    } else {
                        btn.style.backgroundColor = 'rgba(0, 0, 0, 0.1)';
                    }
                });

                // Adjust error cards for dark mode
                document.querySelectorAll('.error-card').forEach(card => {
                    if (isDarkMode) {
                        card.style.borderLeftColor = '#f8d7da';
                    } else {
                        card.style.borderLeftColor = '#721c24';
                    }
                });
            }

            // Call adjustments initially and on theme change
            adjustDarkModeElements();
            themeToggle.addEventListener('click', adjustDarkModeElements);

            // Add a small easter egg for fun
            console.log('%cWelcome to the API Documentation!', 'color: #007bff; font-size: 20px; font-weight: bold;');
            console.log('%cTip: Try clicking the moon/sun icon in the top-right corner.', 'color: #28a745;');
        });</script>
</body>

</html>